# 技术架构文档

## 项目名称：虹桥 (Bifrost) 局域网文件传输助手

### 1. 引言

#### 1.1 文档目的
本文档旨在为开发团队提供关于“虹桥”(Bifrost) 局域网文件传输助手的清晰技术架构和实施细节，确保设计和开发符合预定功能需求。

#### 1.2 项目背景
“虹桥”(Bifrost) 旨在简化用户在不同操作系统间进行文件传输的过程，提供一个高效、便捷的局域网文件传输助手，解决操作复杂、速度慢等问题，提升跨平台文件共享效率。

#### 1.3 技术选型
- **编程语言：** Dart
- **UI 框架：** Flutter

**选择 Dart + Flutter 的理由：**
- **跨平台能力：** 支持 Windows、Linux、iOS、Android 和 macOS 等多个平台。
- **高效性能：** 提供快速开发及高效性能，适合项目需求。
- **现代用户界面：** 美观、流畅的 UI 设计，提升用户体验。
- **社区支持：** 活跃的社区和不断完善的生态系统支持。

---

### 2. 架构概览

“虹桥”(Bifrost) 采用分层架构，主要分为以下几个层级：

- **用户界面层 (UI Layer)：** 负责用户交互和功能入口，基于 Flutter。
- **应用逻辑层 (Application Logic Layer)：** 负责业务逻辑、数据处理，使用 Dart 编写。
- **网络通信层 (Network Communication Layer)：** 负责设备发现、连接、数据传输，使用 Dart 网络库。
- **底层平台适配层 (Platform Adaptation Layer)：** 使用 Platform Channel 或 Dart FFI 实现平台特定功能的适配。

#### 架构图
```mermaid
graph LR
    A[用户界面层 (Flutter UI)] --> B(应用逻辑层 (Dart));
    B --> C[网络通信层 (Dart 网络库)];
    B --> D[底层平台适配层 (Platform Channel / FFI)];
    C --> E[网络 (TCP/IP)];
    D --> F[操作系统 (Windows/Linux/iOS/Android/macOS)];
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style B fill:#ccf,stroke:#333,stroke-width:2px
    style C fill:#ccf,stroke:#333,stroke-width:2px
    style D fill:#ccf,stroke:#333,stroke-width:2px
```

---

### 3. 组件设计

#### 3.1 用户界面层 (UI Layer)
- **技术选型：** Flutter
- **主要功能组件：**
  - 设备列表、文件选择、传输进度、设置、文本传输界面等。

#### 3.2 应用逻辑层 (Application Logic Layer)
- **技术选型：** Dart
- **主要模块：**
  - 设备管理、文件传输管理、文本传输管理、设置管理等。
  - **文件传输管理模块** 扩展了多文件和断点续传功能。

#### 3.3 网络通信层 (Network Communication Layer)
- **技术选型：** Dart `dart:io` 库 (Socket, HttpServer)
- **主要功能：**
  - 设备发现、连接与配对、数据传输、断点续传。
  - **传输协议：** 自定义基于 TCP 的应用层协议。

#### 3.4 底层平台适配层 (Platform Adaptation Layer)
- **技术选型：** Flutter Platform Channel 或 Dart FFI
- **主要适配功能：**
  - 文件系统访问、网络接口调用、特定平台功能适配。

---

### 4. 部署架构

- **部署平台：** 初始支持 Windows 和 Linux，未来扩展至 iOS、Android、macOS。
- **部署方式：** 可执行文件、应用商店或安装包。
- **运行环境依赖：** Dart Runtime 和局域网环境。

---

### 5. 非功能需求实现

#### 5.1 性能需求
- **传输速度：** 通过 Buffered Socket 和流式传输优化性能。
- **资源占用：** 优化内存使用，避免泄漏，使用流式传输大文件。
- **启动速度：** 通过代码裁剪和优化依赖加载提升启动性能。

#### 5.2 可靠性需求
- **稳定性：** 全面的测试保障。
- **兼容性：** 在指定平台进行兼容性测试。
- **错误处理：** 完善的错误提示和日志机制。

#### 5.3 易用性需求
- **用户界面：** 遵循 Material Design 或 Cupertino 设计规范。
- **操作便捷：** 简化操作流程，降低使用门槛。
- **多语言支持：** 未来版本考虑支持多语言。

#### 5.4 可维护性需求
- **代码规范：** 遵循 Dart 编码规范，注重代码的可读性和可维护性。
- **模块化设计：** 高内聚低耦合设计，确保可扩展性。
- **日志记录：** 关键模块记录详细日志，便于调试和问题定位。

---

### 6. 边界条件与异常场景处理

- **大文件传输：** 采用流式传输和断点续传，提升大文件传输效率。
- **设备连接失败：** 提供清晰错误提示和操作建议。
- **网络中断：** 支持自动恢复和断点续传，避免重复传输。
- **低带宽环境：** 自适应调整传输策略，保证传输稳定性。

---

### 7. 安全性考虑

- **局域网环境：** 采用设备配对确认机制，防止未授权访问。
- **数据加密：** 未来可考虑加密方案，如 TLS 或其他加密算法。

---

### 8. 未来扩展方向

- **插件市场：** 允许开发者扩展功能。
- **更多平台支持：** 包括 macOS、鸿蒙 OS。
- **P2P 直连：** 支持无中心服务器的设备发现和文件传输。
- **云同步集成：** 支持局域网与云端的同步。
- **多语言支持：** 提供全球用户支持。

---

### 9. 核心功能流程优化补充

1. **设备连接流程：**
   - 用户手动输入设备 IP 地址或设备名称。
   - 通过 TCP Socket 进行连接。
   - 设备配对确认后，建立可靠的传输通道。

2. **文件传输流程：**
   - 选择待传输文件或文件夹。
   - 确定传输目标设备。
   - 开始传输，支持断点续传。
   - 显示实时进度，传输完成后提供提示。

3. **文本传输流程：**
   - 用户输入文本。
   - 通过自定义协议发送至目标设备。
   - 支持插件扩展文本预览功能。

通过优化流程和组件设计，提升用户体验和系统稳定性。